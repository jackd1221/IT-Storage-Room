<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Check Out an Item</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <h1 style="text-align: center;">Check Out an Item</h1>

  <div class="tab-container">
    <button class="tab-button active" onclick="switchRoom('main')">Main Room</button>
    <button class="tab-button" onclick="switchRoom('second')">Second Room</button>
  </div>

  <form id="checkout-form">
    <label for="item">Item:</label>
    <select id="item" name="item" required>
      <!-- Items will be populated based on selected room -->
    </select>

    <label for="quantity">Quantity:</label>
    <input type="number" id="quantity" name="quantity" min="1" value="1" required>

    <label for="user">Name:</label>
    <input type="text" id="user" name="user" required>

    <label for="location">Location:</label>
    <select id="location" name="location" required>
      <option value="">--Select Location--</option>
      <option value="LaVernge">LaVernge</option>
      <option value="Off-Site Pre School">Off-Site Pre School</option>
      <option value="Out Of District">Out Of District</option>
      <option value="Emerson">Emerson</option>
      <option value="Piper">Piper</option>
      <option value="Pershing">Pershing</option>
      <option value="Irving">Irving</option>
      <option value="Hiawatha">Hiawatha</option>
      <option value="Komensky">Komensky</option>
      <option value="Freedom">Freedom</option>
      <option value="Heritage">Heritage</option>
      <option value="Other">Other</option>
    </select>

    <label for="action">Action:</label>
    <select id="action" name="action" required>
      <option value="checkout">Check Out</option>
      <option value="checkin">Check In</option>
    </select>

    <div class="button-group">
      <button type="submit">Submit</button>
      <button type="button" id="clear-btn">Clear</button>
    </div>
  </form>

  <script>
    const form = document.getElementById("checkout-form");
    const itemSelect = document.getElementById("item");

    const itemsByRoom = {
      main: [
        "iPad Elementary",
        "iPad Middle",
        "Keyboard iPad Case",
        "iPad Case",
        "New iPad Charging Block",
        "Old iPad Charging Block",
        "MacBook",
        "MacBook Charging Block",
        "Apple TV",
        "USB C to USB C",
        "USB A to USB C",
        "Charging Station"
      ],
      second: [
        "XLR Cable",
        "Microphone",
        "Ethernet Cable"
      ]
    };

    function populateItems(room) {
      itemSelect.innerHTML = '<option value="">--Select Item--</option>';
      itemsByRoom[room].forEach(item => {
        const option = document.createElement("option");
        option.value = item;
        option.textContent = item;
        itemSelect.appendChild(option);
      });
    }

    function switchRoom(room) {
      populateItems(room);
      document.querySelectorAll(".tab-button").forEach(btn => btn.classList.remove("active"));
      document.querySelector(`[onclick="switchRoom('${room}')"]`).classList.add("active");
    }

  form.addEventListener("submit", async (e) => {
    e.preventDefault();

    const data = new URLSearchParams({
      item: document.getElementById("item").value,
      quantity: document.getElementById("quantity").value,
      user: document.getElementById("user").value,
      location: document.getElementById("location").value,
      action: document.getElementById("action").value,
      room: currentRoom  // add room info here, too
    });

    try {
      const response = await fetch("https://script.google.com/macros/s/AKfycbxG0iAwR-lXRmOnMWY-Gq8xnAeuhwChPjnYyurdN3w_WlX-5q-EECIOya0QbSrYqtmghg/exec", {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      },
      mode: "cors",
      body: JSON.stringify(data)
    });


      const result = await response.text();
      alert(result);
      form.reset();
      populateItems(currentRoom);  // repopulate after reset
    } catch (err) {
      alert("Error submitting form.");
      console.error(err);
    }
  });

    document.getElementById("clear-btn").addEventListener("click", () => {
      form.reset();
      populateItems(currentRoom);
    });

    // Default to main room on load
    let currentRoom = "main";
    populateItems(currentRoom);
  </script>

</body>
</html>
